package com.avantir.blowfish.mock;

import com.avantir.blowfish.services.SecurityService;
import org.junit.Before;
import org.junit.Test;

import java.security.KeyPair;
import java.security.PrivateKey;
import java.security.PublicKey;

/**
 * Created by lekanomotayo on 19/04/2018.
 */
public class HsmProviderTest {

    HsmProvider hsmProvider;
    SecurityService securityService;

    @Before
    public void setup() throws Exception{
        hsmProvider = new HsmProvider();
        securityService = new SecurityService();
    }

    @Test
    public void testGenerateRSAKeyPair(){

        /*
        String privateEncodedHex = "308204BF020100300D06092A864886F70D0101010500048204A9308204A50201000282010100A5E931D5C8AE2E4DB3CFDDD155B422863392CE8414EE02D3023C527C3501C51B29A00048D620D33A287BB3AF950D6F42695EEDA350B8ADAD17E5AE793A11B0462DD05DEC2FFF118EEE23A75022E73253A02C21E171E39FDAA6E37DE94392AF246D371E73B2A548DFF6E3C3EDECD267722E879D108C4406D646F20E09CFB93AC75F929F0828C01502BC66A99E85DCF99A043C93434E602EA2DB932406D5E340186256316CD115BB3ADD16AF5E5C145D90207ED049C3E10BA9FEF527E74DA8677F957B12BB2E6B4D947031814B95697EBBD91152393ABDEFD9638168859BC379ABEECE784D6920D6E8888A5BE0BC71465AC5D099F7872DF49F00680F05E46E24DB020301000102820101008D157A4D6373CAE84489F504B82E905532B21A6F7324DABDF8DEB6FDEC4D6F01A429ED5402D2B30C77B4899E3BCFCAD6DCA7DEC8CC31DF6E9C2DB26A6018FE9F0F026B7C176C7DCFDF6DEE2F551EE94AF79FCFC7D8834A42333CACAB99CCB8A6EF40B9E284FDCCB4B74C0426E5061EF597DFB68E85D8AB3FB7E0CA534993280956C8FAF924ED166733960FE7199E177445B3AB00E693A457F0274B366DAC29754B2D2069BB81039404D71D9F8C2869D38291FC9B33AC7CC95A671991452C2B7966C39BD414D8B9308BA100D2E24CB12A83920822F144F1592B7D9940685CD2B7E15F016EADB59964749A240A10069F88B5E833CC53B5755CF67AF70150C63AA102818100E0B42052F37439E7C26CD4E9681E424ACD451D0BB86DC4172E36084AD01C4352C88BE57D30AF8F7FC2F348CBBF302F0A6F6DD1D64A553DBAD943B68A5D46F3062EB10A468FF2CA49CF78DCDE5301F90B6198E1B7400D9E19CB22738AB58E459801465783876AE7DC3D15D9CC6218B81A34B8C445494C61F297EEC054DE0B84A302818100BD04CC1BE96D80979C0359E3673C9A4919961EE400C11867BC1A7A11C57944A0896F669C90DE90407F64D456772FFC289B09B4008ACF691B1C8A6820D54F0821D1BDCB036713E51EA2CF0E8EAAFBD2DD73E99BB12ACD69863559280D2A42B677C5FED02E96043662D1C264D3A10E687EFEFC5211CA55D732D11DA8A1E7662A690281804E1E511E8584E29CAFFB2609FF2885E37B798B9F877EA1AD6D635B7EA6DB2C8C9B2C079C7E508A92E033B41B215C9EFE01BF2C3453A34ED2A6B5E3C036AD73CFB26BDA26ADE4BA6EEEB2161734C47AD07A1DAC5B08E9B30D4491B5998384F2ACE5C48EA82B6BFF2F920D06AB076F90918BC2B0796602280B2EC6D216AF1B5201028181009EA19D0EBBBBAB951158FAA24F6CDBEB076F26A3A1426CD1FA5A9A21BA02092755D04964926C46D1EA585B9FE94D3B2974DC12D5F5A91603ABD3388A7D9A632FC6CFAAC64346BE1E14F302BB9721DA99020387278BCD728730D48F39654331D199383DCD2B1783F1312B1CE543204D706F5CA11FCF18758F6F529DC8AAE3E229028181009DF95A3426FA953064D0062C87F4DB8D09D46ECF4662B2F9B7965927531F0F5F68FFC45ADA323540E05566C1B01EEC0C08256BF5A59C15AF58AF8123E4FC1255E9D54DC0A99ABF3A46A2C32E5A424495CB9D91CA1C38888EB75428A2DAB666D511CA84970762FB6B3DDC7F3C340A154B664C5A190813351E64AA4A5554963D12";
        String publicEncodedHex = "30820122300D06092A864886F70D01010105000382010F003082010A0282010100A5E931D5C8AE2E4DB3CFDDD155B422863392CE8414EE02D3023C527C3501C51B29A00048D620D33A287BB3AF950D6F42695EEDA350B8ADAD17E5AE793A11B0462DD05DEC2FFF118EEE23A75022E73253A02C21E171E39FDAA6E37DE94392AF246D371E73B2A548DFF6E3C3EDECD267722E879D108C4406D646F20E09CFB93AC75F929F0828C01502BC66A99E85DCF99A043C93434E602EA2DB932406D5E340186256316CD115BB3ADD16AF5E5C145D90207ED049C3E10BA9FEF527E74DA8677F957B12BB2E6B4D947031814B95697EBBD91152393ABDEFD9638168859BC379ABEECE784D6920D6E8888A5BE0BC71465AC5D099F7872DF49F00680F05E46E24DB0203010001";
        System.out.println(privateEncodedHex);
        System.out.println(publicEncodedHex);
        PublicKey publicKey = securityService.getPublicKey(publicEncodedHex).get();
        PrivateKey privateKey = securityService.getPrivateKey(privateEncodedHex).get();

        String nibssKey = "DBEECACCB4210977ACE73A1D873CA59F";
        String checkDigit = "1DDD47";
        String cryptogram = hsmProvider.encryptWithRSA(publicEncodedHex, nibssKey);
        String cipherText = hsmProvider.decryptWithRSA(privateEncodedHex, cryptogram);
        String checkDigitVerify = hsmProvider.encryptWith3DES(cipherText, "0000000000000000");
        String checkDigitCipher = hsmProvider.decryptWith3DES(cipherText, checkDigitVerify);
        System.out.println(cryptogram);
        System.out.println(checkDigit);
        System.out.println(checkDigitVerify);
        System.out.println(checkDigitCipher);
        */

        String key = "EACE1C67342C0E9745FD1A3D1AC80191";
        String cryptogram = hsmProvider.encryptWith3DES(key, "5399831614073498");
        String cipher = hsmProvider.decryptWith3DES(key, cryptogram);

        System.out.println(cryptogram);
        System.out.println(cipher);
    }

}
